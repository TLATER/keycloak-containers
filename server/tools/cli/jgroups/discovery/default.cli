embed-server --server-config=standalone-ha.xml --std-out=echo

try
    /subsystem=jgroups/stack=udp/protocol=PING:remove()
catch
end-try

try
    /subsystem=jgroups/stack=tcp/protocol=MPING:remove()
catch
end-try

try
    /subsystem=jgroups/stack=udp/protocol=$keycloak_jgroups_discovery_protocol:remove()
catch
end-try

try
    /subsystem=jgroups/stack=tcp/protocol=$keycloak_jgroups_discovery_protocol:remove()
catch
end-try

batch
/subsystem=jgroups/stack=udp/protocol=$keycloak_jgroups_discovery_protocol:add(add-index=0, properties=$keycloak_jgroups_discovery_protocol_properties)
/subsystem=jgroups/stack=tcp/protocol=$keycloak_jgroups_discovery_protocol:add(add-index=0, properties=$keycloak_jgroups_discovery_protocol_properties)
/subsystem=jgroups/channel=ee:write-attribute(name="stack", value=$keycloak_jgroups_transport_stack)
run-batch
stop-embedded-server
